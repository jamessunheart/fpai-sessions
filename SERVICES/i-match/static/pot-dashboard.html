<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POT Economy Dashboard - I MATCH</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 36px;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-label {
            font-size: 14px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 14px;
            color: #48bb78;
        }

        .stat-change.negative {
            color: #f56565;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .chart-container h2 {
            font-size: 24px;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .transactions-list {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .transaction-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-type {
            font-weight: 600;
            color: #2d3748;
        }

        .transaction-amount {
            font-weight: bold;
            font-size: 18px;
        }

        .transaction-amount.earn {
            color: #48bb78;
        }

        .transaction-amount.spend {
            color: #f56565;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .refresh-btn:hover {
            transform: scale(1.05);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
            font-size: 18px;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .category-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .category-item {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .category-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .category-stats {
            font-size: 14px;
            color: #718096;
        }

        .icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .health-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .health-good {
            background: #48bb78;
            box-shadow: 0 0 10px #48bb78;
        }

        .health-warning {
            background: #f6ad55;
            box-shadow: 0 0 10px #f6ad55;
        }

        .health-bad {
            background: #f56565;
            box-shadow: 0 0 10px #f56565;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ POT Economy Dashboard</h1>
            <p>Real-time monitoring of POTENTIAL token system</p>
            <button class="refresh-btn" onclick="loadAllData()" style="margin-top: 15px;">
                üîÑ Refresh Data
            </button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="icon">üè¶</div>
                <div class="stat-label">Total POT in Circulation</div>
                <div class="stat-value" id="total-circulation">-</div>
                <div class="stat-change" id="circulation-change">Loading...</div>
            </div>

            <div class="stat-card">
                <div class="icon">üë•</div>
                <div class="stat-label">Users with POT</div>
                <div class="stat-value" id="users-with-pot">-</div>
                <div class="stat-change" id="participation-rate">-</div>
            </div>

            <div class="stat-card">
                <div class="icon">üìà</div>
                <div class="stat-label">POT Earned (All Time)</div>
                <div class="stat-value" id="total-earned">-</div>
                <div class="stat-change earn">+100% since launch</div>
            </div>

            <div class="stat-card">
                <div class="icon">üìâ</div>
                <div class="stat-label">POT Spent (All Time)</div>
                <div class="stat-value" id="total-spent">-</div>
                <div class="stat-change" id="burn-rate">-</div>
            </div>

            <div class="stat-card">
                <div class="icon">üî•</div>
                <div class="stat-label">POT Burned (Deflationary)</div>
                <div class="stat-value" id="total-burned">-</div>
                <div class="stat-change" id="burned-percent">-</div>
            </div>

            <div class="stat-card">
                <div class="icon">‚ö°</div>
                <div class="stat-label">Transactions (7 Days)</div>
                <div class="stat-value" id="recent-transactions">-</div>
                <div class="stat-change earn">Active economy</div>
            </div>
        </div>

        <div class="chart-container">
            <h2>üìä Economy Health <span class="health-indicator health-good" id="health-indicator"></span></h2>
            <div class="category-breakdown" id="earning-breakdown">
                <div class="loading pulse">Loading earning breakdown...</div>
            </div>
        </div>

        <div class="chart-container">
            <h2>üí∏ Spending Patterns</h2>
            <div class="category-breakdown" id="spending-breakdown">
                <div class="loading pulse">Loading spending breakdown...</div>
            </div>
        </div>

        <div class="transactions-list">
            <h2>üìù Recent Transactions</h2>
            <div id="transactions-container">
                <div class="loading pulse">Loading recent transactions...</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8401';

        async function fetchEconomyStats() {
            try {
                const response = await fetch(`${API_BASE}/pot/economy`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching economy stats:', error);
                return null;
            }
        }

        async function fetchEarningBreakdown() {
            try {
                // This would be a new endpoint we'd add to the API
                // For now, simulate with mock data
                return [
                    { category: 'Profile Creation', count: 45, pot: 2250 },
                    { category: 'Engagement Bonuses', count: 12, pot: 15000 },
                    { category: 'Rating Bonuses', count: 67, pot: 670 },
                    { category: 'Referrals', count: 8, pot: 3500 },
                    { category: 'Content Creation', count: 5, pot: 500 }
                ];
            } catch (error) {
                console.error('Error fetching earning breakdown:', error);
                return [];
            }
        }

        async function fetchSpendingBreakdown() {
            try {
                // This would be a new endpoint we'd add to the API
                return [
                    { category: 'Premium Matches', count: 15, pot: 1500 },
                    { category: 'Profile Boosts', count: 3, pot: 1500 },
                    { category: 'Rush Matches', count: 5, pot: 1000 },
                    { category: 'POT Redemptions', count: 2, pot: 2000 }
                ];
            } catch (error) {
                console.error('Error fetching spending breakdown:', error);
                return [];
            }
        }

        function updateEconomyStats(stats) {
            if (!stats) return;

            document.getElementById('total-circulation').textContent = stats.total_pot_in_circulation.toLocaleString();
            document.getElementById('users-with-pot').textContent = stats.users_with_pot.toLocaleString();
            document.getElementById('participation-rate').textContent = `${stats.participation_rate} participation`;
            document.getElementById('total-earned').textContent = stats.total_pot_earned_all_time.toLocaleString();
            document.getElementById('total-spent').textContent = stats.total_pot_spent_all_time.toLocaleString();
            document.getElementById('total-burned').textContent = stats.total_pot_burned_all_time.toLocaleString();
            document.getElementById('burn-rate').textContent = `${stats.burn_rate} burn rate`;
            document.getElementById('recent-transactions').textContent = stats.transactions_last_7_days.toLocaleString();

            // Calculate burned percentage
            const burnedPercent = stats.total_pot_spent_all_time > 0
                ? ((stats.total_pot_burned_all_time / stats.total_pot_spent_all_time) * 100).toFixed(1)
                : 0;
            document.getElementById('burned-percent').textContent = `${burnedPercent}% of spending`;

            // Update health indicator
            const healthIndicator = document.getElementById('health-indicator');
            const participationNum = parseFloat(stats.participation_rate);
            if (participationNum > 30) {
                healthIndicator.className = 'health-indicator health-good';
            } else if (participationNum > 15) {
                healthIndicator.className = 'health-indicator health-warning';
            } else {
                healthIndicator.className = 'health-indicator health-bad';
            }
        }

        function updateEarningBreakdown(data) {
            const container = document.getElementById('earning-breakdown');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="loading">No earning data yet</div>';
                return;
            }

            container.innerHTML = data.map(item => `
                <div class="category-item">
                    <div class="category-name">${item.category}</div>
                    <div class="category-stats">
                        ${item.count} transactions<br>
                        ${item.pot.toLocaleString()} POT earned
                    </div>
                </div>
            `).join('');
        }

        function updateSpendingBreakdown(data) {
            const container = document.getElementById('spending-breakdown');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="loading">No spending data yet</div>';
                return;
            }

            container.innerHTML = data.map(item => `
                <div class="category-item">
                    <div class="category-name">${item.category}</div>
                    <div class="category-stats">
                        ${item.count} transactions<br>
                        ${item.pot.toLocaleString()} POT spent
                    </div>
                </div>
            `).join('');
        }

        async function loadAllData() {
            // Show loading state
            document.querySelectorAll('.stat-value').forEach(el => {
                el.classList.add('pulse');
            });

            // Fetch all data
            const stats = await fetchEconomyStats();
            const earning = await fetchEarningBreakdown();
            const spending = await fetchSpendingBreakdown();

            // Update UI
            updateEconomyStats(stats);
            updateEarningBreakdown(earning);
            updateSpendingBreakdown(spending);

            // Remove loading state
            document.querySelectorAll('.stat-value').forEach(el => {
                el.classList.remove('pulse');
            });

            // Update last refresh time
            console.log('Dashboard refreshed at', new Date().toLocaleTimeString());
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadAllData);

        // Auto-refresh every 30 seconds
        setInterval(loadAllData, 30000);
    </script>
</body>
</html>
